import{d as X,r as l,k as Y,o as Z,c as n,b as a,e,f as D,s as N,l as ee,F as _,y as P,t as i,n as te,w as se,h as p,D as O,v as x,B as oe}from"./index-DcZlzi53.js";import{o as f}from"./order-COkXjOJN.js";import{c as re}from"./customer-CYEi1lpS.js";import{p as le}from"./product-DQpua61d.js";import{_ as ae}from"./Pagination.vue_vue_type_script_setup_true_lang-DqwkjJFW.js";import"./api-1h7xoGYc.js";const ne={class:"flex justify-between items-center mb-6"},ie={class:"bg-white rounded-lg shadow overflow-hidden"},de={key:0,class:"p-6 text-center"},ue={key:1,class:"p-6 text-center"},ce={key:2,class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},fe={class:"px-6 py-4 whitespace-nowrap"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},we=["onClick"],he=["onClick"],ke={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ce={class:"bg-white rounded-lg shadow-lg w-full max-w-2xl mx-4"},Ee={class:"p-6 border-b border-gray-200"},De={class:"text-lg font-semibold"},Ne={class:"space-y-6"},_e=["value"],Pe={class:"border border-gray-300 rounded-md p-4 space-y-4"},Me=["onUpdate:modelValue","onChange"],Ve=["value"],Se=["onUpdate:modelValue"],Ae=["onClick"],Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$e={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Te={class:"mt-1 relative rounded-md shadow-sm"},je={class:"mt-1 relative rounded-md shadow-sm"},Ue={class:"mt-1 relative rounded-md shadow-sm"},ze={key:0},Be={class:"mt-1 text-lg font-semibold"},qe={class:"mt-6 flex justify-end space-x-3"},Fe=["disabled"],Re={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Le={class:"bg-white rounded-lg shadow-lg w-full max-w-md mx-4"},Ie={class:"p-6"},Ge={class:"mt-6 flex justify-end space-x-3"},He=["disabled"],et=X({__name:"Orders",setup(Je){const m=l([]),M=l([]),V=l([]),S=l(!0),y=l(!1),g=l(!1),b=l(!1),w=l(!1),h=l(!1),k=l(1),A=l(10),C=l(0),$=l(0),o=l({customerId:0,products:{},status:"PENDENTE",cost:0,price:0,debt:0,profit:0}),d=l({}),E=l(null),j=Y(()=>V.value.filter(s=>{const t=Object.values(d.value);return s.id&&!t.includes(s.id)}));Z(async()=>{await Promise.all([v(),U(),z()])});async function v(){try{S.value=!0;const s=await f.getAll({page:k.value-1,size:A.value,sort:"createdDate,desc"});m.value=s.content,C.value=s.totalElements,$.value=s.totalPages}catch(s){console.error("Erro ao carregar pedidos:",s);try{m.value=await f.getAllNonPaginated(),C.value=m.value.length,$.value=1}catch(t){console.error("Erro no fallback:",t)}}finally{S.value=!1}}async function U(){try{M.value=await re.getAll()}catch(s){console.error("Erro ao carregar clientes:",s)}}async function z(){try{const s=await le.getAll();s&&typeof s=="object"&&"content"in s?V.value=s.content:V.value=s}catch(s){console.error("Erro ao carregar produtos:",s)}}function B(s){const t=M.value.find(r=>r.id===s);return t?t.name:`Cliente #${s}`}function q(s){switch(s){case"PENDENTE":return"bg-yellow-100 text-yellow-800";case"EM_ANDAMENTO":return"bg-blue-100 text-blue-800";case"CONCLUIDO":return"bg-green-100 text-green-800";case"CANCELADO":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function F(s){if(!s)return"-";const t=new Date(s);return isNaN(t.getTime())?"Data inválida":new Intl.DateTimeFormat("pt-BR").format(t)}function R(s,t){return!s||!t?"0.00":((s-t)/s*100).toFixed(2)}function T(s){s?(o.value={...s},b.value=!0,d.value={},Object.keys(s.products).forEach(t=>{d.value[parseInt(t)]=parseInt(t)})):(o.value={customerId:0,products:{},status:"PENDENTE",cost:0,price:0,debt:0,profit:0},d.value={},b.value=!1),y.value=!0}function L(){const s=Date.now();o.value.products[s]=1,d.value[s]=0}function I(s){delete o.value.products[s],delete d.value[s]}function G(s){const t=d.value[s];if(t!==s){const r=o.value.products[s];delete o.value.products[s],o.value.products[t]=r,delete d.value[s],d.value[t]=t}}async function H(){try{w.value=!0,o.value.profit=o.value.price-o.value.cost,b.value&&o.value.id?await f.update(o.value.id,o.value):await f.create(o.value),y.value=!1,await v()}catch(s){console.error("Erro ao salvar pedido:",s)}finally{w.value=!1}}function J(s){E.value=s,g.value=!0}async function K(){if(E.value?.id)try{h.value=!0,await f.delete(E.value.id),g.value=!1,await v()}catch(s){console.error("Erro ao excluir pedido:",s)}finally{h.value=!1}}function Q(s){k.value=s,v()}function W(s){A.value=s,k.value=1,v()}return(s,t)=>(a(),n("div",null,[e("div",ne,[t[10]||(t[10]=e("h1",{class:"text-2xl font-semibold"},"Gerenciar Pedidos",-1)),e("button",{onClick:t[0]||(t[0]=r=>T()),class:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 flex items-center"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-plus mr-2"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),N(" Novo Pedido ",-1)])])]),e("div",ie,[S.value?(a(),n("div",de,[...t[11]||(t[11]=[e("p",null,"Carregando...",-1)])])):m.value&&m.value.length===0?(a(),n("div",ue,[...t[12]||(t[12]=[e("p",null,"Nenhum pedido encontrado",-1)])])):(a(),n("div",ce,[e("table",pe,[t[14]||(t[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cliente"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Valor"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Data"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Entrega"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ações")])],-1)),e("tbody",me,[(a(!0),n(_,null,P(m.value||[],r=>(a(),n("tr",{key:r.id},[e("td",ve,"#"+i(r.id),1),e("td",xe,i(B(r.customerId)),1),e("td",fe,[e("span",{class:te([q(r.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},i(r.status),3)]),e("td",ye,"R$ "+i(r.price.toFixed(2)),1),t[13]||(t[13]=e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},"-",-1)),e("td",ge,i(F(r.deliveryDate)),1),e("td",be,[e("button",{onClick:c=>T(r),class:"text-blue-600 hover:text-blue-900 mr-3"}," Editar ",8,we),e("button",{onClick:c=>J(r),class:"text-red-600 hover:text-red-900"}," Excluir ",8,he)])]))),128))])])])),C.value>0?(a(),ee(ae,{key:3,"current-page":k.value,"total-items":C.value,"page-size":A.value,onPageChanged:Q,onPageSizeChanged:W},null,8,["current-page","total-items","page-size"])):D("",!0)]),y.value?(a(),n("div",ke,[e("div",Ce,[e("div",Ee,[e("h3",De,i(b.value?"Editar Pedido":"Novo Pedido"),1)]),e("form",{onSubmit:se(H,["prevent"]),class:"p-6"},[e("div",Ne,[e("div",null,[t[16]||(t[16]=e("label",{for:"customer",class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),p(e("select",{id:"customer","onUpdate:modelValue":t[1]||(t[1]=r=>o.value.customerId=r),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Selecione um cliente",-1)),(a(!0),n(_,null,P(M.value,r=>(a(),n("option",{key:r.id,value:r.id},i(r.name),9,_e))),128))],512),[[O,o.value.customerId]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Produtos",-1)),e("div",Pe,[(a(!0),n(_,null,P(o.value.products,(r,c)=>(a(),n("div",{key:c,class:"flex items-center space-x-4"},[p(e("select",{"onUpdate:modelValue":u=>d.value[c]=u,class:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:u=>G(c)},[t[17]||(t[17]=e("option",{value:"",disabled:""},"Selecione um produto",-1)),(a(!0),n(_,null,P(j.value,u=>(a(),n("option",{key:u.id,value:u.id},i(u.name||u.key)+" - R$ "+i((u.price||0).toFixed(2)),9,Ve))),128))],40,Me),[[O,d.value[c]]]),p(e("input",{type:"number","onUpdate:modelValue":u=>o.value.products[c]=u,min:"1",class:"w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,8,Se),[[x,o.value.products[c],void 0,{number:!0}]]),e("button",{type:"button",onClick:u=>I(c),class:"text-red-600 hover:text-red-900"},[...t[18]||(t[18]=[oe('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>',1)])],8,Ae)]))),128)),e("button",{type:"button",onClick:L,class:"mt-2 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center"},[...t[19]||(t[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-plus mr-2"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),N(" Adicionar Produto ",-1)])])])]),e("div",Oe,[e("div",null,[t[22]||(t[22]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),p(e("select",{id:"status","onUpdate:modelValue":t[2]||(t[2]=r=>o.value.status=r),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},[...t[21]||(t[21]=[e("option",{value:"PENDENTE"},"Pendente",-1),e("option",{value:"EM_ANDAMENTO"},"Em Andamento",-1),e("option",{value:"CONCLUIDO"},"Concluído",-1),e("option",{value:"CANCELADO"},"Cancelado",-1)])],512),[[O,o.value.status]])]),e("div",null,[t[23]||(t[23]=e("label",{for:"deliveryDate",class:"block text-sm font-medium text-gray-700"},"Data de Entrega",-1)),p(e("input",{id:"deliveryDate","onUpdate:modelValue":t[3]||(t[3]=r=>o.value.deliveryDate=r),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,o.value.deliveryDate]])])]),e("div",$e,[e("div",null,[t[25]||(t[25]=e("label",{for:"cost",class:"block text-sm font-medium text-gray-700"},"Custo Total",-1)),e("div",Te,[t[24]||(t[24]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"cost","onUpdate:modelValue":t[4]||(t[4]=r=>o.value.cost=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,o.value.cost,void 0,{number:!0}]])])]),e("div",null,[t[27]||(t[27]=e("label",{for:"price",class:"block text-sm font-medium text-gray-700"},"Preço Total",-1)),e("div",je,[t[26]||(t[26]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"price","onUpdate:modelValue":t[5]||(t[5]=r=>o.value.price=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,o.value.price,void 0,{number:!0}]])])]),e("div",null,[t[29]||(t[29]=e("label",{for:"debt",class:"block text-sm font-medium text-gray-700"},"Valor em Aberto",-1)),e("div",Ue,[t[28]||(t[28]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"debt","onUpdate:modelValue":t[6]||(t[6]=r=>o.value.debt=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,o.value.debt,void 0,{number:!0}]])])])]),o.value.price&&o.value.cost?(a(),n("div",ze,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Lucro",-1)),e("div",Be," R$ "+i((o.value.price-o.value.cost).toFixed(2))+" ("+i(R(o.value.price,o.value.cost))+"%) ",1)])):D("",!0)]),e("div",qe,[e("button",{type:"button",onClick:t[7]||(t[7]=r=>y.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancelar "),e("button",{type:"submit",class:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90",disabled:w.value},i(w.value?"Salvando...":"Salvar"),9,Fe)])],32)])])):D("",!0),g.value?(a(),n("div",Re,[e("div",Le,[e("div",Ie,[t[33]||(t[33]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirmar Exclusão",-1)),e("p",null,[t[31]||(t[31]=N("Tem certeza que deseja excluir o pedido ",-1)),e("strong",null,"#"+i(E.value?.id),1),t[32]||(t[32]=N("?",-1))]),e("div",Ge,[e("button",{type:"button",onClick:t[8]||(t[8]=r=>g.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancelar "),e("button",{type:"button",onClick:K,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",disabled:h.value},i(h.value?"Excluindo...":"Excluir"),9,He)])])])])):D("",!0)]))}});export{et as default};
