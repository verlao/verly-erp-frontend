import{T as Y,G as o,F as K,z as X,_ as u,f as e,u as D,e as N,w as ee,O as A,g as P,a as d,Z as te,W as p,Y as U,Q as x,L as s,m as ae,i as le}from"./index-D6gXMe8l.js";import{a as y}from"./order-Byjw7WAC-Bw4C_qA3.js";import{i as re}from"./customer-WExQ0j1N-shtQL4Ef.js";import{r as oe}from"./product-D0CDyfc9-DodzjxVd.js";import{Z as se}from"./Pagination.vue_vue_type_script_setup_true_lang-CbB9wug3-Bi09SReQ.js";import"./api-FIA6GHks-BQrTW_pe.js";const ue={class:"flex justify-between items-center mb-6"},de={class:"bg-white rounded-lg shadow overflow-hidden"},ne={key:0,class:"p-6 text-center"},ie={key:1,class:"p-6 text-center"},ce={key:2,class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},he=["onClick"],we=["onClick"],ke={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ce={class:"bg-white rounded-lg shadow-lg w-full max-w-2xl mx-4"},Ee={class:"p-6 border-b border-gray-200"},De={class:"text-lg font-semibold"},Ne={class:"space-y-6"},Ae=["value"],Pe={class:"border border-gray-300 rounded-md p-4 space-y-4"},Ve=["onUpdate:modelValue","onChange"],Te=["value"],je=["onUpdate:modelValue"],Oe=["onClick"],Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Me={class:"mt-1 relative rounded-md shadow-sm"},$e={class:"mt-1 relative rounded-md shadow-sm"},ze={class:"mt-1 relative rounded-md shadow-sm"},Se={key:0},Fe={class:"mt-1 text-lg font-semibold"},Le={class:"mt-6 flex justify-end space-x-3"},Re=["disabled"],qe={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ge={class:"bg-white rounded-lg shadow-lg w-full max-w-md mx-4"},_e={class:"p-6"},Be={class:"mt-6 flex justify-end space-x-3"},He=["disabled"],et=Y({__name:"Orders",setup(Qe){const m=o([]),V=o([]),T=o([]),j=o(!0),f=o(!1),g=o(!1),b=o(!1),h=o(!1),w=o(!1),k=o(1),O=o(10),C=o(0),I=o(0),l=o({customerId:0,products:{},status:"PENDENTE",cost:0,price:0,debt:0,profit:0}),n=o({}),E=o(null),$=K(()=>T.value.filter(a=>{const t=Object.values(n.value);return a.id&&!t.includes(a.id)}));X(async()=>{await Promise.all([v(),z(),S()])});async function v(){try{j.value=!0;const a=await y.getAll({page:k.value-1,size:O.value,sort:"createdDate,desc"});m.value=a.content,C.value=a.totalElements,I.value=a.totalPages}catch(a){console.error("Erro ao carregar pedidos:",a);try{m.value=await y.getAllNonPaginated(),C.value=m.value.length,I.value=1}catch(t){console.error("Erro no fallback:",t)}}finally{j.value=!1}}async function z(){try{V.value=await re.getAll()}catch(a){console.error("Erro ao carregar clientes:",a)}}async function S(){try{const a=await oe.getAll();a&&typeof a=="object"&&"content"in a?T.value=a.content:T.value=a}catch(a){console.error("Erro ao carregar produtos:",a)}}function F(a){const t=V.value.find(r=>r.id===a);return t?t.name:`Cliente #${a}`}function L(a){switch(a){case"PENDENTE":return"bg-yellow-100 text-yellow-800";case"EM_ANDAMENTO":return"bg-blue-100 text-blue-800";case"CONCLUIDO":return"bg-green-100 text-green-800";case"CANCELADO":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function R(a){if(!a)return"-";const t=new Date(a);return isNaN(t.getTime())?"Data inválida":new Intl.DateTimeFormat("pt-BR").format(t)}function q(a,t){return!a||!t?"0.00":((a-t)/a*100).toFixed(2)}function M(a){a?(l.value={...a},b.value=!0,n.value={},Object.keys(a.products).forEach(t=>{n.value[parseInt(t)]=parseInt(t)})):(l.value={customerId:0,products:{},status:"PENDENTE",cost:0,price:0,debt:0,profit:0},n.value={},b.value=!1),f.value=!0}function G(){const a=Date.now();l.value.products[a]=1,n.value[a]=0}function _(a){delete l.value.products[a],delete n.value[a]}function B(a){const t=n.value[a];if(t!==a){const r=l.value.products[a];delete l.value.products[a],l.value.products[t]=r,delete n.value[a],n.value[t]=t}}async function H(){try{h.value=!0,l.value.profit=l.value.price-l.value.cost,b.value&&l.value.id?await y.update(l.value.id,l.value):await y.create(l.value),f.value=!1,await v()}catch(a){console.error("Erro ao salvar pedido:",a)}finally{h.value=!1}}function Q(a){E.value=a,g.value=!0}async function W(){if(E.value?.id)try{w.value=!0,await y.delete(E.value.id),g.value=!1,await v()}catch(a){console.error("Erro ao excluir pedido:",a)}finally{w.value=!1}}function Z(a){k.value=a,v()}function J(a){O.value=a,k.value=1,v()}return(a,t)=>(s(),u("div",null,[e("div",ue,[t[10]||(t[10]=e("h1",{class:"text-2xl font-semibold"},"Gerenciar Pedidos",-1)),e("button",{onClick:t[0]||(t[0]=r=>M()),class:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 flex items-center"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-plus mr-2"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),N(" Novo Pedido ",-1)])])]),e("div",de,[j.value?(s(),u("div",ne,[...t[11]||(t[11]=[e("p",null,"Carregando...",-1)])])):m.value&&m.value.length===0?(s(),u("div",ie,[...t[12]||(t[12]=[e("p",null,"Nenhum pedido encontrado",-1)])])):(s(),u("div",ce,[e("table",pe,[t[14]||(t[14]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cliente"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Valor"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Data"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Entrega"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ações")])],-1)),e("tbody",me,[(s(!0),u(A,null,P(m.value||[],r=>(s(),u("tr",{key:r.id},[e("td",ve,"#"+d(r.id),1),e("td",xe,d(F(r.customerId)),1),e("td",ye,[e("span",{class:ae([L(r.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},d(r.status),3)]),e("td",fe,"R$ "+d(r.price.toFixed(2)),1),t[13]||(t[13]=e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},"-",-1)),e("td",ge,d(R(r.deliveryDate)),1),e("td",be,[e("button",{onClick:c=>M(r),class:"text-blue-600 hover:text-blue-900 mr-3"}," Editar ",8,he),e("button",{onClick:c=>Q(r),class:"text-red-600 hover:text-red-900"}," Excluir ",8,we)])]))),128))])])])),C.value>0?(s(),ee(se,{key:3,"current-page":k.value,"total-items":C.value,"page-size":O.value,onPageChanged:Z,onPageSizeChanged:J},null,8,["current-page","total-items","page-size"])):D("",!0)]),f.value?(s(),u("div",ke,[e("div",Ce,[e("div",Ee,[e("h3",De,d(b.value?"Editar Pedido":"Novo Pedido"),1)]),e("form",{onSubmit:te(H,["prevent"]),class:"p-6"},[e("div",Ne,[e("div",null,[t[16]||(t[16]=e("label",{for:"customer",class:"block text-sm font-medium text-gray-700"},"Cliente",-1)),p(e("select",{id:"customer","onUpdate:modelValue":t[1]||(t[1]=r=>l.value.customerId=r),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},[t[15]||(t[15]=e("option",{value:"",disabled:""},"Selecione um cliente",-1)),(s(!0),u(A,null,P(V.value,r=>(s(),u("option",{key:r.id,value:r.id},d(r.name),9,Ae))),128))],512),[[U,l.value.customerId]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Produtos",-1)),e("div",Pe,[(s(!0),u(A,null,P(l.value.products,(r,c)=>(s(),u("div",{key:c,class:"flex items-center space-x-4"},[p(e("select",{"onUpdate:modelValue":i=>n.value[c]=i,class:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:i=>B(c)},[t[17]||(t[17]=e("option",{value:"",disabled:""},"Selecione um produto",-1)),(s(!0),u(A,null,P($.value,i=>(s(),u("option",{key:i.id,value:i.id},d(i.name||i.key)+" - R$ "+d((i.price||0).toFixed(2)),9,Te))),128))],40,Ve),[[U,n.value[c]]]),p(e("input",{type:"number","onUpdate:modelValue":i=>l.value.products[c]=i,min:"1",class:"w-20 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,8,je),[[x,l.value.products[c],void 0,{number:!0}]]),e("button",{type:"button",onClick:i=>_(c),class:"text-red-600 hover:text-red-900"},[...t[18]||(t[18]=[le('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>',1)])],8,Oe)]))),128)),e("button",{type:"button",onClick:G,class:"mt-2 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center"},[...t[19]||(t[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-plus mr-2"},[e("path",{d:"M5 12h14"}),e("path",{d:"M12 5v14"})],-1),N(" Adicionar Produto ",-1)])])])]),e("div",Ue,[e("div",null,[t[22]||(t[22]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),p(e("select",{id:"status","onUpdate:modelValue":t[2]||(t[2]=r=>l.value.status=r),required:"",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},[...t[21]||(t[21]=[e("option",{value:"PENDENTE"},"Pendente",-1),e("option",{value:"EM_ANDAMENTO"},"Em Andamento",-1),e("option",{value:"CONCLUIDO"},"Concluído",-1),e("option",{value:"CANCELADO"},"Cancelado",-1)])],512),[[U,l.value.status]])]),e("div",null,[t[23]||(t[23]=e("label",{for:"deliveryDate",class:"block text-sm font-medium text-gray-700"},"Data de Entrega",-1)),p(e("input",{id:"deliveryDate","onUpdate:modelValue":t[3]||(t[3]=r=>l.value.deliveryDate=r),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,l.value.deliveryDate]])])]),e("div",Ie,[e("div",null,[t[25]||(t[25]=e("label",{for:"cost",class:"block text-sm font-medium text-gray-700"},"Custo Total",-1)),e("div",Me,[t[24]||(t[24]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"cost","onUpdate:modelValue":t[4]||(t[4]=r=>l.value.cost=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,l.value.cost,void 0,{number:!0}]])])]),e("div",null,[t[27]||(t[27]=e("label",{for:"price",class:"block text-sm font-medium text-gray-700"},"Preço Total",-1)),e("div",$e,[t[26]||(t[26]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"price","onUpdate:modelValue":t[5]||(t[5]=r=>l.value.price=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,l.value.price,void 0,{number:!0}]])])]),e("div",null,[t[29]||(t[29]=e("label",{for:"debt",class:"block text-sm font-medium text-gray-700"},"Valor em Aberto",-1)),e("div",ze,[t[28]||(t[28]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1)),p(e("input",{id:"debt","onUpdate:modelValue":t[6]||(t[6]=r=>l.value.debt=r),type:"number",step:"0.01",min:"0",required:"",class:"pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},null,512),[[x,l.value.debt,void 0,{number:!0}]])])])]),l.value.price&&l.value.cost?(s(),u("div",Se,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700"},"Lucro",-1)),e("div",Fe," R$ "+d((l.value.price-l.value.cost).toFixed(2))+" ("+d(q(l.value.price,l.value.cost))+"%) ",1)])):D("",!0)]),e("div",Le,[e("button",{type:"button",onClick:t[7]||(t[7]=r=>f.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancelar "),e("button",{type:"submit",class:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90",disabled:h.value},d(h.value?"Salvando...":"Salvar"),9,Re)])],32)])])):D("",!0),g.value?(s(),u("div",qe,[e("div",Ge,[e("div",_e,[t[33]||(t[33]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirmar Exclusão",-1)),e("p",null,[t[31]||(t[31]=N("Tem certeza que deseja excluir o pedido ",-1)),e("strong",null,"#"+d(E.value?.id),1),t[32]||(t[32]=N("?",-1))]),e("div",Be,[e("button",{type:"button",onClick:t[8]||(t[8]=r=>g.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancelar "),e("button",{type:"button",onClick:W,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",disabled:w.value},d(w.value?"Excluindo...":"Excluir"),9,He)])])])])):D("",!0)]))}});export{et as default};
